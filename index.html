<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO AIditor - Multi-Page Intelligence</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
        }

        .gradient-bg {
            background: #1a1a1a;
            border-bottom: 1px solid #2a2a2a;
        }

        /* Logo */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-img {
            height: 50px;
            width: auto;
        }

        @media (max-width: 640px) {
            .logo-img {
                height: 40px;
            }
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            border-bottom: 2px solid #2a2a2a;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background: #1a1a1a;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .tab-nav::-webkit-scrollbar {
            height: 4px;
        }

        .tab-nav::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 2px;
        }

        .tab-button {
            padding: 1rem 1.5rem;
            font-weight: 500;
            color: #9ca3af;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .tab-button:hover {
            color: #f97316;
            background: #242424;
        }

        .tab-button.active {
            color: #f97316;
            border-bottom-color: #f97316;
            background: #242424;
        }

        .tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            background: #374151;
            color: #f97316;
        }

        /* Mobile responsive */
        .page-selector {
            display: block;
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #374151;
            background: #1a1a1a;
            color: #e0e0e0;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .pages-sidebar {
            display: none;
        }

        @media (min-width: 768px) {
            .page-selector {
                display: none;
            }

            .pages-sidebar {
                display: block;
                position: sticky;
                top: 70px;
                width: 280px;
                max-height: calc(100vh - 90px);
                overflow-y: auto;
            }

            .pages-content {
                flex: 1;
                margin-left: 1.5rem;
            }
        }

        /* Score colors */
        .score-excellent { color: #10B981; }
        .score-good { color: #84CC16; }
        .score-warning { color: #F59E0B; }
        .score-poor { color: #EF4444; }
        .score-critical { color: #DC2626; }

        /* Progress bars */
        .progress-bar {
            transition: width 0.5s ease;
        }

        /* Badges */
        .badge-critical {
            background-color: #991b1b;
            color: #fca5a5;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-important {
            background-color: #c2410c;
            color: #fed7aa;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-recommendation {
            background-color: #0c4a6e;
            color: #7dd3fc;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Collapsible */
        .collapsible-header {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .collapsible-header:hover {
            background-color: #242424;
        }

        /* Timeline */
        .timeline-item {
            position: relative;
            padding-left: 2rem;
            padding-bottom: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #374151;
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .timeline-dot {
            position: absolute;
            left: 0;
            top: 0.25rem;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            border: 3px solid #1a1a1a;
            box-shadow: 0 0 0 2px currentColor;
        }

        /* Override Tailwind for dark theme */
        .bg-white { background: #1a1a1a !important; }
        .text-gray-700 { color: #d1d5db !important; }
        .text-gray-600 { color: #9ca3af !important; }
        .text-gray-500 { color: #6b7280 !important; }
        .text-gray-800 { color: #e5e7eb !important; }
        .text-gray-900 { color: #f3f4f6 !important; }
        .border-gray-300 { border-color: #374151 !important; }
        .border-gray-200 { border-color: #2a2a2a !important; }
        .bg-gray-50 { background: #242424 !important; }
        .bg-gray-100 { background: #2a2a2a !important; }
        .bg-blue-50 { background: #1e3a5f !important; }
        .bg-blue-100 { background: #1e40af !important; }
        .bg-green-50 { background: #14532d !important; }
        .bg-green-100 { background: #166534 !important; }
        .bg-red-50 { background: #7f1d1d !important; }
        .bg-red-100 { background: #991b1b !important; }
        .bg-purple-50 { background: rgba(168, 85, 247, 0.15) !important; }
        .bg-purple-100 { background: rgba(168, 85, 247, 0.2) !important; }
        .bg-orange-50 { background: rgba(249, 115, 22, 0.15) !important; }
        .bg-yellow-50 { background: rgba(245, 158, 11, 0.15) !important; }
        .bg-pink-100 { background: rgba(236, 72, 153, 0.2) !important; }
        .bg-indigo-50 { background: rgba(99, 102, 241, 0.15) !important; }
        .border-purple-200 { border-color: #6b21a8 !important; }
        .border-blue-200 { border-color: #1e40af !important; }
        .border-green-200 { border-color: #166534 !important; }
        .border-red-200 { border-color: #991b1b !important; }
        .border-orange-200 { border-color: #9a3412 !important; }
        .text-purple-900 { color: #c084fc !important; }
        .text-red-900 { color: #fca5a5 !important; }
        .text-orange-900 { color: #fed7aa !important; }
        .text-blue-900 { color: #93c5fd !important; }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2) !important; }
    </style>
</head>
<body style="background: #0f0f0f;">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Helper function: Auto-detect API URL based on environment
        function getApiUrl(endpoint) {
            const isLocal = window.location.hostname === 'localhost' ||
                            window.location.hostname === '127.0.0.1';
            return isLocal ? `http://localhost:5000${endpoint}` : endpoint;
        }

        // API Keys Modal Component
        function ApiKeysModal({ show, onClose, onSave, initialKeys }) {
            const [keys, setKeys] = useState(initialKeys || { gemini: '', psi: '' });
            const [remember, setRemember] = useState(false);
            const [showKeys, setShowKeys] = useState({ gemini: false, psi: false });

            if (!show) return null;

            const handleSave = () => {
                if (!keys.gemini || keys.gemini.trim() === '') {
                    alert('Gemini API key is required!');
                    return;
                }

                // Save keys based on remember preference
                if (remember) {
                    localStorage.setItem('gemini_key', keys.gemini);
                    localStorage.setItem('psi_key', keys.psi);
                    localStorage.setItem('remember_keys', 'true');
                } else {
                    sessionStorage.setItem('gemini_key', keys.gemini);
                    sessionStorage.setItem('psi_key', keys.psi);
                    // Clear from localStorage if exists
                    localStorage.removeItem('gemini_key');
                    localStorage.removeItem('psi_key');
                    localStorage.removeItem('remember_keys');
                }

                onSave(keys);
                onClose();
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0, 0, 0, 0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 9999,
                    padding: '20px'
                }}>
                    <div style={{
                        background: '#1a1a1a',
                        borderRadius: '12px',
                        padding: '32px',
                        maxWidth: '600px',
                        width: '100%',
                        maxHeight: '90vh',
                        overflow: 'auto',
                        border: '1px solid #333'
                    }}>
                        <h2 style={{ color: '#f97316', marginBottom: '16px', fontSize: '24px' }}>
                            üîë API Keys Required
                        </h2>

                        <p style={{ color: '#9ca3af', marginBottom: '24px', lineHeight: '1.6' }}>
                            SEO AIditor is free, but requires your own Google API keys to function.
                            Keys are stored only in your browser and used only during analysis.
                        </p>

                        <div style={{ marginBottom: '24px', padding: '16px', background: '#2a2a2a', borderRadius: '8px', border: '1px solid #3a3a3a' }}>
                            <p style={{ color: '#fbbf24', fontSize: '14px', marginBottom: '8px' }}>
                                üìö <strong>New to API keys?</strong>
                            </p>
                            <a
                                href="https://github.com/maciusman/seo-aiditor/blob/master/GETTING_API_KEYS.md"
                                target="_blank"
                                rel="noopener noreferrer"
                                style={{ color: '#60a5fa', textDecoration: 'underline', fontSize: '14px' }}
                            >
                                Read the 2-minute guide ‚Üí
                            </a>
                        </div>

                        {/* Gemini API Key (Required) */}
                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', color: '#e5e7eb', marginBottom: '8px', fontWeight: '600' }}>
                                Google Gemini API Key <span style={{ color: '#f87171' }}>*</span>
                            </label>
                            <div style={{ position: 'relative' }}>
                                <input
                                    type={showKeys.gemini ? 'text' : 'password'}
                                    value={keys.gemini}
                                    onChange={(e) => setKeys({ ...keys, gemini: e.target.value })}
                                    placeholder="AIza..."
                                    style={{
                                        width: '100%',
                                        padding: '12px',
                                        paddingRight: '40px',
                                        background: '#0f0f0f',
                                        border: '1px solid #3a3a3a',
                                        borderRadius: '6px',
                                        color: '#e5e7eb',
                                        fontSize: '14px',
                                        fontFamily: 'monospace'
                                    }}
                                />
                                <button
                                    onClick={() => setShowKeys({ ...showKeys, gemini: !showKeys.gemini })}
                                    style={{
                                        position: 'absolute',
                                        right: '8px',
                                        top: '50%',
                                        transform: 'translateY(-50%)',
                                        background: 'transparent',
                                        border: 'none',
                                        color: '#9ca3af',
                                        cursor: 'pointer',
                                        fontSize: '18px'
                                    }}
                                >
                                    {showKeys.gemini ? 'üôà' : 'üëÅÔ∏è'}
                                </button>
                            </div>
                            <a
                                href="https://aistudio.google.com/apikey"
                                target="_blank"
                                rel="noopener noreferrer"
                                style={{
                                    display: 'inline-block',
                                    marginTop: '8px',
                                    color: '#60a5fa',
                                    fontSize: '13px',
                                    textDecoration: 'none'
                                }}
                            >
                                ‚Üí Get free Gemini key (5 req/min, 25/day)
                            </a>
                        </div>

                        {/* PageSpeed API Key (Optional) */}
                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', color: '#e5e7eb', marginBottom: '8px', fontWeight: '600' }}>
                                PageSpeed Insights API Key <span style={{ color: '#9ca3af', fontSize: '13px' }}>(optional)</span>
                            </label>
                            <div style={{ position: 'relative' }}>
                                <input
                                    type={showKeys.psi ? 'text' : 'password'}
                                    value={keys.psi}
                                    onChange={(e) => setKeys({ ...keys, psi: e.target.value })}
                                    placeholder="Optional - for detailed Performance tab"
                                    style={{
                                        width: '100%',
                                        padding: '12px',
                                        paddingRight: '40px',
                                        background: '#0f0f0f',
                                        border: '1px solid #3a3a3a',
                                        borderRadius: '6px',
                                        color: '#e5e7eb',
                                        fontSize: '14px',
                                        fontFamily: 'monospace'
                                    }}
                                />
                                <button
                                    onClick={() => setShowKeys({ ...showKeys, psi: !showKeys.psi })}
                                    style={{
                                        position: 'absolute',
                                        right: '8px',
                                        top: '50%',
                                        transform: 'translateY(-50%)',
                                        background: 'transparent',
                                        border: 'none',
                                        color: '#9ca3af',
                                        cursor: 'pointer',
                                        fontSize: '18px'
                                    }}
                                >
                                    {showKeys.psi ? 'üôà' : 'üëÅÔ∏è'}
                                </button>
                            </div>
                            <a
                                href="https://console.cloud.google.com/apis/library/pagespeedonline.googleapis.com"
                                target="_blank"
                                rel="noopener noreferrer"
                                style={{
                                    display: 'inline-block',
                                    marginTop: '8px',
                                    color: '#60a5fa',
                                    fontSize: '13px',
                                    textDecoration: 'none'
                                }}
                            >
                                ‚Üí Get free PSI key (25K req/day)
                            </a>
                            <p style={{ color: '#9ca3af', fontSize: '12px', marginTop: '8px' }}>
                                ‚ö†Ô∏è Without PSI key: Basic performance metrics only (no detailed Lighthouse data)
                            </p>
                        </div>

                        {/* Remember checkbox */}
                        <div style={{ marginBottom: '24px', padding: '16px', background: '#2a2a2a', borderRadius: '8px' }}>
                            <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer', color: '#e5e7eb' }}>
                                <input
                                    type="checkbox"
                                    checked={remember}
                                    onChange={(e) => setRemember(e.target.checked)}
                                    style={{ marginRight: '12px', width: '18px', height: '18px', cursor: 'pointer' }}
                                />
                                <span>Remember keys in this browser</span>
                            </label>
                            <p style={{ color: '#9ca3af', fontSize: '12px', marginTop: '8px', marginLeft: '30px' }}>
                                {remember ?
                                    '‚ö†Ô∏è Only use on trusted, personal devices. Keys will persist in localStorage.' :
                                    'üîí Keys will be deleted when you close this tab (sessionStorage).'
                                }
                            </p>
                        </div>

                        {/* Info box */}
                        <div style={{
                            marginBottom: '24px',
                            padding: '12px',
                            background: 'rgba(59, 130, 246, 0.1)',
                            border: '1px solid rgba(59, 130, 246, 0.3)',
                            borderRadius: '6px'
                        }}>
                            <p style={{ color: '#93c5fd', fontSize: '13px', lineHeight: '1.5' }}>
                                ‚ÑπÔ∏è <strong>Privacy:</strong> Keys are stored in YOUR browser only, sent to server only during analysis, and never logged or saved server-side.
                            </p>
                        </div>

                        {/* Buttons */}
                        <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    padding: '12px 24px',
                                    background: 'transparent',
                                    border: '1px solid #3a3a3a',
                                    borderRadius: '6px',
                                    color: '#9ca3af',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                disabled={!keys.gemini || keys.gemini.trim() === ''}
                                style={{
                                    padding: '12px 24px',
                                    background: keys.gemini ? '#f97316' : '#3a3a3a',
                                    border: 'none',
                                    borderRadius: '6px',
                                    color: keys.gemini ? '#fff' : '#6b7280',
                                    cursor: keys.gemini ? 'pointer' : 'not-allowed',
                                    fontSize: '14px',
                                    fontWeight: '600'
                                }}
                            >
                                Save & Continue
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [url, setUrl] = useState('');
            const [loading, setLoading] = useState(false);
            const [auditResults, setAuditResults] = useState(null);
            const [progress, setProgress] = useState(0);
            const [currentStep, setCurrentStep] = useState('');
            const [error, setError] = useState(null);

            // API Keys state (production mode)
            const [requireUserKeys, setRequireUserKeys] = useState(false);
            const [showApiKeysModal, setShowApiKeysModal] = useState(false);
            const [apiKeys, setApiKeys] = useState({
                gemini: localStorage.getItem('gemini_key') || sessionStorage.getItem('gemini_key') || '',
                psi: localStorage.getItem('psi_key') || sessionStorage.getItem('psi_key') || ''
            });

            // Check environment on component mount
            useEffect(() => {
                fetch('/api/config')
                    .then(r => r.json())
                    .then(config => {
                        setRequireUserKeys(config.require_user_keys);
                        // Show modal on first visit in production if no keys
                        if (config.require_user_keys && !apiKeys.gemini) {
                            // Don't show immediately - let user see the UI first
                            // They'll see it when they click "Analyze"
                        }
                    })
                    .catch(err => {
                        console.log('Using local mode (config endpoint not available)');
                        setRequireUserKeys(false);
                    });
            }, []);

            const runAudit = async () => {
                if (!url) {
                    alert('Proszƒô wprowadziƒá URL');
                    return;
                }

                // Check if API keys are required and available
                if (requireUserKeys && !apiKeys.gemini) {
                    setShowApiKeysModal(true);
                    return;
                }

                setLoading(true);
                setProgress(0);
                setError(null);
                setAuditResults(null);

                try {
                    const progressSteps = [
                        'Pobieranie strony g≈Ç√≥wnej...',
                        'Analiza techniczna...',
                        'Analiza on-page SEO...',
                        'Sprawdzanie indeksowania...',
                        'Analiza tre≈õci...',
                        'AI: Analiza jako≈õci tre≈õci...',
                        'AI: Wykrywanie typu witryny...',
                        'AI: Wyb√≥r reprezentatywnych stron...',
                        'Pobieranie dodatkowych stron...',
                        'AI: Holistyczna analiza...',
                        'Generowanie rekomendacji...',
                        'PageSpeed Full analysis...'
                    ];

                    let stepIndex = 0;
                    const progressInterval = setInterval(() => {
                        if (stepIndex < progressSteps.length) {
                            setCurrentStep(progressSteps[stepIndex]);
                            setProgress(Math.min((stepIndex / progressSteps.length) * 90, 90));
                            stepIndex++;
                        }
                    }, 4000);

                    const API_URL = getApiUrl('/api/audit');

                    // Build request body
                    const requestBody = { url: url };
                    if (requireUserKeys) {
                        requestBody.gemini_key = apiKeys.gemini;
                        requestBody.psi_key = apiKeys.psi;
                    }

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });

                    clearInterval(progressInterval);

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'B≈ÇƒÖd podczas audytu');
                    }

                    const results = await response.json();

                    setProgress(100);
                    setCurrentStep('Audyt uko≈Ñczony!');
                    setAuditResults(results);

                } catch (err) {
                    setError(err.message);
                    console.error('B≈ÇƒÖd audytu:', err);
                } finally {
                    setLoading(false);
                }
            };

            const exportToCSV = () => {
                if (!auditResults) return;
                const dataStr = JSON.stringify(auditResults, null, 2);
                const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `seo-audit-${Date.now()}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const exportToJSON = () => {
                if (!auditResults) return;
                const dataStr = JSON.stringify(auditResults, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `seo-audit-${Date.now()}.json`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const exportToHTML = async () => {
                if (!auditResults) return;

                try {
                    const response = await fetch(getApiUrl('/api/export/html'), {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ results: auditResults })
                    });

                    if (!response.ok) {
                        throw new Error('Export failed');
                    }

                    // Get blob and create download link
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `seo-audit-${Date.now()}.html`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                } catch (error) {
                    alert('B≈ÇƒÖd podczas eksportu HTML: ' + error.message);
                }
            };

            const handleApiKeysSave = (keys) => {
                setApiKeys(keys);
                // Keys are already saved to storage in the modal component
                // Just update state and allow audit to proceed
            };

            return (
                <div className="min-h-screen">
                    {/* API Keys Modal */}
                    <ApiKeysModal
                        show={showApiKeysModal}
                        onClose={() => setShowApiKeysModal(false)}
                        onSave={handleApiKeysSave}
                        initialKeys={apiKeys}
                    />

                    {/* Header */}
                    <header className="gradient-bg text-white py-4 px-4 shadow-lg">
                        <div className="max-w-7xl mx-auto">
                            <div className="logo-container">
                                <img src="logo.png" alt="SEO AIditor" className="logo-img" />
                                <div>
                                    <h1 className="text-xl md:text-2xl font-bold" style={{color: '#f3f4f6'}}>SEO AIditor</h1>
                                    <p className="text-xs md:text-sm" style={{color: '#9ca3af'}}>Multi-Page Intelligence √ó AI-Powered Insights</p>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* URL Input */}
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="bg-white rounded-lg shadow-md p-4 md:p-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Wprowad≈∫ URL strony do audytu
                            </label>
                            <div className="flex flex-col md:flex-row gap-3">
                                <input
                                    type="url"
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                    placeholder="https://example.com"
                                    className="flex-1 px-4 py-3 border border-gray-300 rounded-lg"
                                    style={{background: '#1a1a1a', color: '#e0e0e0', borderColor: '#374151'}}
                                    disabled={loading}
                                    onKeyPress={(e) => e.key === 'Enter' && runAudit()}
                                    onFocus={(e) => e.target.style.outline = '2px solid #f97316'}
                                    onBlur={(e) => e.target.style.outline = 'none'}
                                />
                                <button
                                    onClick={runAudit}
                                    disabled={loading}
                                    className="px-8 py-3 text-white rounded-lg font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed transition shadow-md"
                                    style={{background: loading ? '#6b7280' : '#f97316'}}
                                    onMouseEnter={(e) => !loading && (e.target.style.background = '#ea580c')}
                                    onMouseLeave={(e) => !loading && (e.target.style.background = '#f97316')}
                                >
                                    {loading ? 'Analizujƒô...' : 'Uruchom audyt'}
                                </button>
                            </div>
                        </div>

                        {/* Loading State */}
                        {loading && (
                            <div className="mt-6 bg-white rounded-lg shadow-md p-6">
                                <div className="mb-4">
                                    <div className="flex justify-between text-sm mb-2">
                                        <span className="font-medium text-gray-700">{currentStep}</span>
                                        <span className="text-gray-500">{progress}%</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3">
                                        <div
                                            className="progress-bar bg-gradient-to-r from-purple-600 to-indigo-600 h-3 rounded-full"
                                            style={{width: `${progress}%`}}
                                        ></div>
                                    </div>
                                </div>
                                <p className="text-sm text-gray-600 loading-pulse">
                                    ‚è≥ Multi-page analiza mo≈ºe potrwaƒá 30-90 sekund...
                                </p>
                            </div>
                        )}

                        {/* Error State */}
                        {error && (
                            <div className="mt-6 bg-red-50 border-l-4 border-red-500 rounded-lg p-4">
                                <p className="text-red-800 font-medium">‚ùå B≈ÇƒÖd: {error}</p>
                            </div>
                        )}

                        {/* Results */}
                        {auditResults && !loading && (
                            <AuditResults
                                results={auditResults}
                                exportCSV={exportToCSV}
                                exportJSON={exportToJSON}
                                exportHTML={exportToHTML}
                                onNewAudit={() => setAuditResults(null)}
                            />
                        )}
                    </div>

                    {/* Footer */}
                    <footer className="mt-12 py-6 text-center text-sm" style={{borderTop: '1px solid #2a2a2a'}}>
                        <p style={{color: '#9ca3af'}}>
                            Generated by <strong style={{color: '#f97316'}}>SEO AIditor</strong> &copy; 2025 | Powered by Gemini 2.5 Flash AI
                        </p>
                    </footer>
                </div>
            );
        }

        // Main Results Component
        function AuditResults({ results, exportCSV, exportJSON, exportHTML, onNewAudit }) {
            const [activeTab, setActiveTab] = useState('overview');
            const [selectedPageId, setSelectedPageId] = useState('homepage');

            const isMultiPage = results.audit_type === 'multi-page';

            // For multi-page, prepare data
            const allPages = isMultiPage ? [
                {
                    id: 'homepage',
                    label: 'üè† Strona g≈Ç√≥wna',
                    url: results.url,
                    data: results.homepage
                },
                ...(results.additional_pages || []).map((page, idx) => ({
                    id: `page-${idx}`,
                    label: page.page_type || 'Strona',
                    url: page.url,
                    data: page
                }))
            ] : [];

            const tabs = isMultiPage ? [
                { id: 'overview', label: 'PrzeglƒÖd', icon: 'üìä', badge: null },
                { id: 'pages', label: 'Strony', icon: 'üìÑ', badge: results.pages_analyzed },
                { id: 'templates', label: 'Szablony', icon: 'üé®', badge: results.site_wide_analysis?.template_insights?.length || 0 },
                { id: 'issues', label: 'Problemy', icon: '‚ö†Ô∏è', badge: (results.homepage?.all_issues?.length || 0) + (results.site_wide_analysis?.cross_page_issues?.length || 0) },
                { id: 'performance', label: 'Performance', icon: '‚ö°', badge: null },
                { id: 'strategy', label: 'Strategia', icon: 'üéØ', badge: null }
            ] : [
                { id: 'overview', label: 'PrzeglƒÖd', icon: 'üìä', badge: null },
                { id: 'categories', label: 'Kategorie', icon: 'üìã', badge: Object.keys(results.categories || {}).length },
                { id: 'issues', label: 'Problemy', icon: '‚ö†Ô∏è', badge: results.all_issues?.length || 0 },
                { id: 'performance', label: 'Performance', icon: '‚ö°', badge: null },
                { id: 'quickwins', label: 'Quick Wins', icon: '‚ö°', badge: results.quick_wins?.length || 0 }
            ];

            return (
                <div className="mt-6">
                    {/* Tab Navigation */}
                    <div className="tab-nav rounded-t-lg">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                className={`tab-button ${activeTab === tab.id ? 'active' : ''}`}
                                onClick={() => setActiveTab(tab.id)}
                            >
                                <span className="text-lg">{tab.icon}</span>
                                <span className="hidden md:inline">{tab.label}</span>
                                {tab.badge !== null && tab.badge > 0 && (
                                    <span className="tab-badge">{tab.badge}</span>
                                )}
                            </button>
                        ))}
                    </div>

                    {/* Tab Content */}
                    <div className="mt-6">
                        {isMultiPage ? (
                            <>
                                {activeTab === 'overview' && <OverviewTabMulti results={results} exportCSV={exportCSV} exportJSON={exportJSON} exportHTML={exportHTML} />}
                                {activeTab === 'pages' && <PagesTabMulti results={results} allPages={allPages} selectedPageId={selectedPageId} setSelectedPageId={setSelectedPageId} />}
                                {activeTab === 'templates' && <TemplatesTab results={results} />}
                                {activeTab === 'issues' && <IssuesTabMulti results={results} />}
                                {activeTab === 'performance' && <PerformanceTab results={results} />}
                                {activeTab === 'strategy' && <StrategyTab results={results} />}
                            </>
                        ) : (
                            <>
                                {activeTab === 'overview' && <OverviewTabSingle results={results} exportCSV={exportCSV} exportJSON={exportJSON} exportHTML={exportHTML} />}
                                {activeTab === 'categories' && <CategoriesTab results={results} />}
                                {activeTab === 'issues' && <IssuesTabSingle results={results} />}
                                {activeTab === 'performance' && <PerformanceTab results={results} />}
                                {activeTab === 'quickwins' && <QuickWinsTab results={results} />}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // Utility functions
        const getScoreColor = (score) => {
            if (score >= 90) return 'score-excellent';
            if (score >= 75) return 'score-good';
            if (score >= 60) return 'score-warning';
            if (score >= 40) return 'score-poor';
            return 'score-critical';
        };

        const getBadgeClass = (severity) => {
            if (severity === 'critical') return 'badge-critical';
            if (severity === 'important') return 'badge-important';
            return 'badge-recommendation';
        };

        const formatUrl = (url) => {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname + urlObj.pathname;
            } catch {
                return url;
            }
        };

        // MULTI-PAGE TAB COMPONENTS

        function OverviewTabMulti({ results, exportCSV, exportJSON, exportHTML }) {
            const siteWide = results.site_wide_analysis || {};

            return (
                <div className="space-y-6">
                    {/* Executive Summary */}
                    <div className="bg-white rounded-lg p-6 border border-purple-200">
                        <h3 className="text-xl font-bold text-purple-900 mb-3">üìù Podsumowanie wykonawcze</h3>
                        <p className="text-gray-700 leading-relaxed">
                            {siteWide.executive_summary || 'Multi-page analysis wykonana pomy≈õlnie. Przeanalizowano ' + results.pages_analyzed + ' stron witryny ' + results.site_type + '.'}
                        </p>
                    </div>

                    {/* Score Cards */}
                    <div className="grid md:grid-cols-3 gap-4">
                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-sm text-gray-600 mb-2">Wynik strony g≈Ç√≥wnej</div>
                            <div className={`text-5xl font-bold ${getScoreColor(results.final_score)}`}>
                                {results.final_score}
                            </div>
                            <div className="text-sm text-gray-500 mt-1">{results.grade?.label || 'N/A'}</div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-sm text-gray-600 mb-2">Wynik holistyczny</div>
                            <div className={`text-5xl font-bold ${getScoreColor(siteWide.holistic_score || 0)}`}>
                                {siteWide.holistic_score || 0}
                            </div>
                            <div className="text-sm text-gray-500 mt-1">Ca≈Ço≈õciowa ocena SEO</div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-sm text-gray-600 mb-2">Przeanalizowane strony</div>
                            <div className="text-5xl font-bold text-purple-600">
                                {results.pages_analyzed}
                            </div>
                            <div className="text-sm text-gray-500 mt-1">{results.site_type} ({results.site_type_confidence}%)</div>
                        </div>
                    </div>

                    {/* Pages Preview */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-lg font-bold mb-4">üåê Przeanalizowane strony</h3>
                        <div className="space-y-3">
                            {/* Homepage */}
                            <div className="p-4 bg-purple-50 border-l-4 border-purple-500 rounded">
                                <div className="flex justify-between items-start">
                                    <div className="flex-1">
                                        <div className="font-semibold text-purple-900">üè† Strona g≈Ç√≥wna</div>
                                        <div className="text-sm text-gray-600 break-all mt-1">{results.url}</div>
                                    </div>
                                    <div className={`text-2xl font-bold ${getScoreColor(results.final_score)}`}>
                                        {results.final_score}
                                    </div>
                                </div>
                            </div>

                            {/* Additional pages */}
                            {results.additional_pages && results.additional_pages.map((page, idx) => (
                                <div key={idx} className="p-4 bg-gray-50 border-l-4 border-gray-300 rounded">
                                    <div className="font-semibold capitalize">{page.page_type}</div>
                                    <div className="text-sm text-gray-600 break-all mt-1">{page.url}</div>
                                    <div className="text-xs text-gray-500 mt-2">üí° {page.selection_reason}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Export */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-lg font-bold mb-4">üì• Eksport wynik√≥w</h3>
                        <div className="flex flex-wrap gap-3">
                            <button onClick={exportHTML} className="px-6 py-3 text-white rounded-lg transition shadow-md" style={{background: '#f97316'}}
                                onMouseEnter={(e) => e.target.style.background = '#ea580c'}
                                onMouseLeave={(e) => e.target.style.background = '#f97316'}>
                                üåê Eksport HTML (Interaktywny)
                            </button>
                            <button onClick={exportJSON} className="px-6 py-3 text-white rounded-lg transition shadow-md" style={{background: '#1e40af'}}
                                onMouseEnter={(e) => e.target.style.background = '#1e3a8a'}
                                onMouseLeave={(e) => e.target.style.background = '#1e40af'}>
                                üìÑ Eksport JSON
                            </button>
                            <button onClick={exportCSV} className="px-6 py-3 text-white rounded-lg transition shadow-md" style={{background: '#166534'}}
                                onMouseEnter={(e) => e.target.style.background = '#14532d'}
                                onMouseLeave={(e) => e.target.style.background = '#166534'}>
                                üìä Eksport CSV
                            </button>
                        </div>
                        <p className="text-sm text-gray-500 mt-3">
                            üí° <strong>HTML:</strong> Pe≈Çny raport z zak≈Çadkami - dzia≈Ça offline, mo≈ºna wys≈Çaƒá klientowi
                        </p>
                    </div>
                </div>
            );
        }

        function PagesTabMulti({ results, allPages, selectedPageId, setSelectedPageId }) {
            const selectedPage = allPages.find(p => p.id === selectedPageId);

            return (
                <div>
                    {/* Mobile dropdown */}
                    <select
                        className="page-selector"
                        value={selectedPageId}
                        onChange={(e) => setSelectedPageId(e.target.value)}
                    >
                        {allPages.map(page => (
                            <option key={page.id} value={page.id}>{page.label} - {formatUrl(page.url)}</option>
                        ))}
                    </select>

                    {/* Desktop layout */}
                    <div className="md:flex">
                        {/* Sidebar */}
                        <div className="pages-sidebar bg-white rounded-lg shadow-md p-4">
                            <h3 className="font-bold mb-3 text-gray-700">Wybierz stronƒô</h3>
                            <div className="space-y-2">
                                {allPages.map(page => (
                                    <button
                                        key={page.id}
                                        onClick={() => setSelectedPageId(page.id)}
                                        className={`w-full text-left px-4 py-3 rounded-lg transition border-l-4 ${
                                            selectedPageId === page.id
                                                ? 'bg-purple-100 text-purple-900 font-semibold border-purple-500'
                                                : 'border-transparent'
                                        }`}
                                        style={selectedPageId !== page.id ? {
                                            color: '#9ca3af'
                                        } : {}}
                                        onMouseEnter={(e) => {
                                            if (selectedPageId !== page.id) {
                                                e.currentTarget.style.background = '#2a2a2a';
                                                e.currentTarget.style.color = '#e5e7eb';
                                                const urlDiv = e.currentTarget.querySelector('.url-text');
                                                if (urlDiv) urlDiv.style.color = '#9ca3af';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (selectedPageId !== page.id) {
                                                e.currentTarget.style.background = 'transparent';
                                                e.currentTarget.style.color = '#9ca3af';
                                                const urlDiv = e.currentTarget.querySelector('.url-text');
                                                if (urlDiv) urlDiv.style.color = '#6b7280';
                                            }
                                        }}
                                    >
                                        <div className="font-medium">{page.label}</div>
                                        <div className="url-text text-xs mt-1 truncate" style={{color: '#6b7280'}}>{formatUrl(page.url)}</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Content */}
                        <div className="pages-content">
                            {selectedPage && (
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h3 className="text-xl font-bold mb-2">{selectedPage.label}</h3>
                                    <a href={selectedPage.url} target="_blank" rel="noopener" className="text-sm text-blue-600 hover:underline break-all block mb-6">
                                        {selectedPage.url} ‚Üó
                                    </a>

                                    {selectedPageId === 'homepage' ? (
                                        <CategoriesTab results={selectedPage.data} showUrl={false} />
                                    ) : (
                                        <div className="space-y-4">
                                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                                <p className="text-sm"><strong>Pow√≥d wyboru:</strong> {selectedPage.data.selection_reason}</p>
                                                <p className="text-sm mt-2"><strong>Oczekiwane spostrze≈ºenia:</strong> {selectedPage.data.expected_insights}</p>
                                            </div>
                                            <p className="text-gray-500 text-sm">
                                                ‚ÑπÔ∏è Dla dodatkowych stron dostƒôpna jest tylko holistyczna analiza AI (zobacz zak≈Çadki: Szablony i Strategia).
                                            </p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function TemplatesTab({ results }) {
            const siteWide = results.site_wide_analysis || {};
            const templateInsights = siteWide.template_insights || [];

            if (templateInsights.length === 0) {
                return (
                    <div className="bg-white rounded-lg shadow-md p-8 text-center">
                        <p className="text-gray-500">Brak informacji o szablonach. Multi-page analysis mo≈ºe nie byƒá dostƒôpna lub nie wykryto wzorc√≥w szablon√≥w.</p>
                    </div>
                );
            }

            // Build page types coverage table
            const analyzedPages = [
                { page_type: 'homepage', url: results.url, label: 'üè† Strona g≈Ç√≥wna' },
                ...(results.additional_pages || [])
            ];

            // Map template insights to page types for coverage
            const pageTypesWithInsights = new Set(
                templateInsights
                    .map(t => t.page_type || t.template_name)
                    .filter(Boolean)
            );

            return (
                <div className="space-y-4">
                    <div className="bg-white rounded-lg p-6 border border-purple-200">
                        <h3 className="text-xl font-bold mb-2 text-purple-900">üé® Analiza szablon√≥w</h3>
                        <p className="text-gray-700">
                            Problemy wykryte na poziomie szablon√≥w wp≈ÇywajƒÖ na wiele stron jednocze≈õnie.
                            <strong> Naprawienie jednego szablonu = naprawienie dziesiƒÖtek stron!</strong>
                        </p>
                    </div>

                    {/* Page Types Coverage Table */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h4 className="text-lg font-bold mb-4">üìã Pokrycie analizy</h4>
                        <p className="text-sm text-gray-600 mb-4">Przeanalizowane typy stron:</p>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="border-b border-gray-200">
                                        <th className="text-left py-2 px-3 font-semibold">Typ strony</th>
                                        <th className="text-left py-2 px-3 font-semibold">URL</th>
                                        <th className="text-left py-2 px-3 font-semibold">Pow√≥d wyboru</th>
                                        <th className="text-center py-2 px-3 font-semibold">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {analyzedPages.map((page, idx) => {
                                        const hasInsight = pageTypesWithInsights.has(page.page_type);
                                        return (
                                            <tr key={idx} className="border-b border-gray-100" style={{transition: 'background 0.2s'}}
                                                onMouseEnter={(e) => e.currentTarget.style.background = '#f3f4f6'}
                                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}>
                                                <td className="py-3 px-3">
                                                    <span className="font-medium">{page.label || page.page_type}</span>
                                                </td>
                                                <td className="py-3 px-3">
                                                    <a href={page.url} target="_blank" rel="noopener noreferrer"
                                                       className="text-blue-600 hover:text-blue-800 hover:underline text-xs">
                                                        {page.url}
                                                    </a>
                                                </td>
                                                <td className="py-3 px-3 text-gray-600 text-xs">
                                                    {page.selection_reason || 'Strona g≈Ç√≥wna - punkt wyj≈õcia'}
                                                </td>
                                                <td className="py-3 px-3 text-center">
                                                    {hasInsight ? (
                                                        <span className="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold" style={{
                                                            background: '#166534',
                                                            color: '#bbf7d0'
                                                        }}>
                                                            <span style={{lineHeight: '1'}}>‚úì</span>
                                                            <span>Przeanalizowano</span>
                                                        </span>
                                                    ) : (
                                                        <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                            background: '#6b7280',
                                                            color: '#e5e7eb'
                                                        }}>
                                                            Brak insight√≥w
                                                        </span>
                                                    )}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Template Insights */}
                    {templateInsights.map((template, idx) => (
                        <div key={idx} className="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <h4 className="text-lg font-bold">{template.template_name}</h4>
                                    <p className="text-sm text-gray-600">Dotyczy: <strong>{template.pages_affected}</strong></p>
                                </div>
                                <div className="flex gap-2">
                                    <span className="px-3 py-1 rounded-full text-xs font-semibold" style={{
                                        background: template.seo_impact === 'HIGH' ? '#991b1b' :
                                                   template.seo_impact === 'MEDIUM' ? '#d97706' : '#166534',
                                        color: template.seo_impact === 'HIGH' ? '#fca5a5' :
                                               template.seo_impact === 'MEDIUM' ? '#fef3c7' : '#bbf7d0'
                                    }}>
                                        {template.seo_impact} SEO
                                    </span>
                                    <span className="px-3 py-1 rounded-full text-xs font-semibold" style={{
                                        background: template.fix_difficulty === 'EASY' ? '#166534' :
                                                   template.fix_difficulty === 'MEDIUM' ? '#d97706' : '#991b1b',
                                        color: template.fix_difficulty === 'EASY' ? '#bbf7d0' :
                                               template.fix_difficulty === 'MEDIUM' ? '#fef3c7' : '#fca5a5'
                                    }}>
                                        {template.fix_difficulty}
                                    </span>
                                </div>
                            </div>

                            <div className="space-y-3">
                                {template.critical_issues && template.critical_issues.length > 0 && (
                                    <div className="bg-red-50 border border-red-200 rounded p-3">
                                        <h5 className="font-semibold text-sm mb-2 text-red-900">‚ùå Krytyczne problemy:</h5>
                                        <ul className="list-disc list-inside space-y-1 text-sm text-gray-700">
                                            {template.critical_issues.map((issue, i) => (
                                                <li key={i}>{issue}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                <div className="bg-blue-50 border border-blue-200 rounded p-3">
                                    <p className="text-sm"><strong>üíº Wp≈Çyw biznesowy:</strong> {template.business_impact}</p>
                                </div>

                                <div className="bg-green-50 border border-green-200 rounded p-3">
                                    <p className="text-sm"><strong>üîß Zalecana naprawa:</strong> {template.recommended_fix}</p>
                                </div>

                                <div className="bg-purple-50 border border-purple-200 rounded p-3">
                                    <p className="text-sm"><strong>üìà Oczekiwana poprawa:</strong> {template.expected_improvement}</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function IssuesTabMulti({ results }) {
            const [sortBy, setSortBy] = useState('impact');
            const [filterSeverity, setFilterSeverity] = useState('all');

            // Collect issues from homepage with URL
            let allIssues = [];
            if (results.homepage && results.homepage.all_issues) {
                allIssues = results.homepage.all_issues.map(issue => ({
                    ...issue,
                    url: results.url,
                    pageLabel: 'üè† Strona g≈Ç√≥wna'
                }));
            }

            // Add cross-page issues
            if (results.site_wide_analysis && results.site_wide_analysis.cross_page_issues) {
                allIssues = [...allIssues, ...results.site_wide_analysis.cross_page_issues.map(issue => ({
                    title: issue.issue,
                    description: issue.recommended_solution,
                    severity: issue.severity.toLowerCase(),
                    impact: issue.severity === 'CRITICAL' ? 10 : issue.severity === 'HIGH' ? 8 : 5,
                    url: 'multiple',
                    pageLabel: 'üåê Wiele stron',
                    pagesAffected: issue.pages_affected
                }))];
            }

            // Filter
            let filteredIssues = allIssues;
            if (filterSeverity !== 'all') {
                filteredIssues = filteredIssues.filter(issue => issue.severity === filterSeverity);
            }

            // Sort
            if (sortBy === 'impact') {
                filteredIssues.sort((a, b) => (b.impact || 0) - (a.impact || 0));
            } else if (sortBy === 'severity') {
                const severityOrder = { critical: 0, important: 1, recommendation: 2 };
                filteredIssues.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);
            }

            return (
                <div className="bg-white rounded-lg shadow-md p-6">
                    <h3 className="text-xl font-bold mb-4">‚ö†Ô∏è Wszystkie problemy ({filteredIssues.length})</h3>

                    {/* Filters */}
                    <div className="flex flex-col md:flex-row gap-3 mb-6 pb-6 border-b">
                        <div className="flex-1">
                            <label className="text-sm block mb-1" style={{color: '#1f2937'}}>Sortuj wed≈Çug:</label>
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className="w-full px-4 py-2 border rounded-lg"
                            >
                                <option value="impact">Wp≈Çyw (malejƒÖco)</option>
                                <option value="severity">Waga</option>
                            </select>
                        </div>
                        <div className="flex-1">
                            <label className="text-sm block mb-1" style={{color: '#1f2937'}}>Filtruj wed≈Çug wagi:</label>
                            <select
                                value={filterSeverity}
                                onChange={(e) => setFilterSeverity(e.target.value)}
                                className="w-full px-4 py-2 border rounded-lg"
                            >
                                <option value="all">Wszystkie ({allIssues.length})</option>
                                <option value="critical">Krytyczne ({allIssues.filter(i => i.severity === 'critical').length})</option>
                                <option value="important">Wa≈ºne ({allIssues.filter(i => i.severity === 'important').length})</option>
                                <option value="recommendation">Rekomendacje ({allIssues.filter(i => i.severity === 'recommendation').length})</option>
                            </select>
                        </div>
                    </div>

                    {/* Issues list */}
                    <div className="space-y-3">
                        {filteredIssues.length === 0 ? (
                            <p className="text-gray-500 text-center py-8">Brak problem√≥w do wy≈õwietlenia.</p>
                        ) : (
                            filteredIssues.map((issue, idx) => (
                                <div key={idx} className="p-4 border-l-4 border-orange-500 bg-orange-50 rounded-r hover:shadow-md transition">
                                    <div className="flex items-start justify-between gap-3 mb-2">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-2">
                                                <span className={getBadgeClass(issue.severity)}>{issue.severity?.toUpperCase()}</span>
                                                <span className="text-xs text-gray-500">Impact: {issue.impact}/10</span>
                                                <span className="text-xs px-2 py-1 rounded" style={{background: '#1e40af', color: '#bfdbfe'}}>{issue.pageLabel}</span>
                                            </div>
                                            <h4 className="font-bold text-gray-800">{issue.title}</h4>
                                        </div>
                                    </div>

                                    <p className="text-sm text-gray-700 mb-2">{issue.description}</p>

                                    {/* URL reference */}
                                    <div className="mt-3 pt-3 border-t border-orange-200">
                                        <p className="text-xs text-gray-600 mb-1"><strong>üîó Dotyczy:</strong></p>
                                        {issue.url === 'multiple' ? (
                                            <p className="text-xs text-gray-600 bg-white px-2 py-1 rounded inline-block">
                                                {issue.pagesAffected || 'Wiele stron'}
                                            </p>
                                        ) : (
                                            <a href={issue.url} target="_blank" rel="noopener" className="text-xs text-blue-600 hover:underline break-all">
                                                {issue.url} ‚Üó
                                            </a>
                                        )}
                                    </div>

                                    {issue.fix && (
                                        <div className="mt-3 bg-white border border-orange-200 rounded p-2">
                                            <p className="text-xs text-gray-600"><strong>üîß Jak naprawiƒá:</strong></p>
                                            <p className="text-xs text-gray-700 mt-1">{issue.fix}</p>
                                        </div>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }

        function PerformanceTab({ results }) {
            // Get pagespeed_full data (works for both single-page and multi-page)
            const perfData = results.pagespeed_full || results.homepage?.pagespeed_full;

            if (!perfData || !perfData.success) {
                return (
                    <div className="bg-white rounded-lg shadow-md p-8 text-center">
                        <p className="text-gray-500">
                            {perfData?.error ? `B≈ÇƒÖd PageSpeed: ${perfData.error}` : 'Brak danych PageSpeed. Uruchom ponownie audyt.'}
                        </p>
                    </div>
                );
            }

            const mobile = perfData.mobile;
            const desktop = perfData.desktop;

            const getScoreColor = (score) => {
                if (score >= 90) return '#10b981';
                if (score >= 50) return '#f59e0b';
                return '#ef4444';
            };

            const getRatingColor = (rating) => {
                if (rating === 'good') return {bg: '#166534', text: '#bbf7d0'};
                if (rating === 'needs-improvement') return {bg: '#d97706', text: '#fef3c7'};
                return {bg: '#991b1b', text: '#fca5a5'};
            };

            const getRatingLabel = (rating) => {
                if (rating === 'good') return 'Dobry';
                if (rating === 'needs-improvement') return 'Do poprawy';
                return 'S≈Çaby';
            };

            return (
                <div className="space-y-6">
                    {/* Scores Overview */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-xl font-bold mb-4">üìä Lighthouse Scores</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            {/* Mobile */}
                            <div>
                                <h4 className="font-bold mb-3 flex items-center gap-2">
                                    üì± Mobile
                                </h4>
                                <div className="space-y-3">
                                    {Object.entries(mobile.scores).filter(([key]) => key !== 'average').map(([category, score]) => (
                                        <div key={category}>
                                            <div className="flex justify-between items-center mb-1">
                                                <span className="text-sm capitalize">{category === 'best_practices' ? 'Best Practices' : category}</span>
                                                <span className="font-bold" style={{color: getScoreColor(score)}}>{score}/100</span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                <div className="h-2 rounded-full transition-all" style={{width: `${score}%`, background: getScoreColor(score)}}></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Desktop */}
                            <div>
                                <h4 className="font-bold mb-3 flex items-center gap-2">
                                    üñ•Ô∏è Desktop
                                </h4>
                                <div className="space-y-3">
                                    {Object.entries(desktop.scores).filter(([key]) => key !== 'average').map(([category, score]) => (
                                        <div key={category}>
                                            <div className="flex justify-between items-center mb-1">
                                                <span className="text-sm capitalize">{category === 'best_practices' ? 'Best Practices' : category}</span>
                                                <span className="font-bold" style={{color: getScoreColor(score)}}>{score}/100</span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                <div className="h-2 rounded-full transition-all" style={{width: `${score}%`, background: getScoreColor(score)}}></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Core Web Vitals */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-xl font-bold mb-4">‚ö° Core Web Vitals</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            {/* Mobile CWV */}
                            <div>
                                <h4 className="font-bold mb-3">üì± Mobile</h4>
                                <div className="space-y-4">
                                    {/* LCP */}
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(mobile.core_web_vitals.lcp.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">LCP (Largest Contentful Paint)</div>
                                                <div className="text-2xl font-bold mt-1">{mobile.core_web_vitals.lcp.value_s}s</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(mobile.core_web_vitals.lcp.rating).bg,
                                                color: getRatingColor(mobile.core_web_vitals.lcp.rating).text
                                            }}>
                                                {getRatingLabel(mobile.core_web_vitals.lcp.rating)}
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">Powinno: &lt;2.5s (dobry), &lt;4.0s (do poprawy)</div>
                                    </div>

                                    {/* FID */}
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(mobile.core_web_vitals.fid.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">FID (First Input Delay)</div>
                                                <div className="text-2xl font-bold mt-1">{mobile.core_web_vitals.fid.value}ms</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(mobile.core_web_vitals.fid.rating).bg,
                                                color: getRatingColor(mobile.core_web_vitals.fid.rating).text
                                            }}>
                                                {getRatingLabel(mobile.core_web_vitals.fid.rating)}
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">Powinno: &lt;100ms (dobry), &lt;300ms (do poprawy)</div>
                                    </div>

                                    {/* CLS */}
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(mobile.core_web_vitals.cls.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">CLS (Cumulative Layout Shift)</div>
                                                <div className="text-2xl font-bold mt-1">{mobile.core_web_vitals.cls.value.toFixed(3)}</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(mobile.core_web_vitals.cls.rating).bg,
                                                color: getRatingColor(mobile.core_web_vitals.cls.rating).text
                                            }}>
                                                {getRatingLabel(mobile.core_web_vitals.cls.rating)}
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">Powinno: &lt;0.1 (dobry), &lt;0.25 (do poprawy)</div>
                                    </div>
                                </div>
                            </div>

                            {/* Desktop CWV */}
                            <div>
                                <h4 className="font-bold mb-3">üñ•Ô∏è Desktop</h4>
                                <div className="space-y-4">
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(desktop.core_web_vitals.lcp.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">LCP</div>
                                                <div className="text-2xl font-bold mt-1">{desktop.core_web_vitals.lcp.value_s}s</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(desktop.core_web_vitals.lcp.rating).bg,
                                                color: getRatingColor(desktop.core_web_vitals.lcp.rating).text
                                            }}>
                                                {getRatingLabel(desktop.core_web_vitals.lcp.rating)}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(desktop.core_web_vitals.fid.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">FID</div>
                                                <div className="text-2xl font-bold mt-1">{desktop.core_web_vitals.fid.value}ms</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(desktop.core_web_vitals.fid.rating).bg,
                                                color: getRatingColor(desktop.core_web_vitals.fid.rating).text
                                            }}>
                                                {getRatingLabel(desktop.core_web_vitals.fid.rating)}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="p-3 rounded border" style={{borderColor: getRatingColor(desktop.core_web_vitals.cls.rating).bg}}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold">CLS</div>
                                                <div className="text-2xl font-bold mt-1">{desktop.core_web_vitals.cls.value.toFixed(3)}</div>
                                            </div>
                                            <span className="px-2 py-1 rounded text-xs font-semibold" style={{
                                                background: getRatingColor(desktop.core_web_vitals.cls.rating).bg,
                                                color: getRatingColor(desktop.core_web_vitals.cls.rating).text
                                            }}>
                                                {getRatingLabel(desktop.core_web_vitals.cls.rating)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Opportunities */}
                    {mobile.opportunities && mobile.opportunities.length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-xl font-bold mb-4">üéØ Top Optimization Opportunities (Mobile)</h3>
                            <div className="space-y-3">
                                {mobile.opportunities.map((opp, idx) => (
                                    <div key={idx} className="border-l-4 border-orange-500 bg-orange-50 rounded-r p-4">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-bold flex-1">{opp.title}</h4>
                                            <span className="px-3 py-1 rounded text-xs font-semibold ml-2" style={{background: '#f97316', color: '#fff'}}>
                                                üíæ ~{opp.savings_s}s
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-700" dangerouslySetInnerHTML={{__html: opp.description}}></p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Link to full PSI report */}
                    <div className="bg-white rounded-lg shadow-md p-6 text-center">
                        <h3 className="text-lg font-bold mb-3">üîó Pe≈Çny raport PageSpeed Insights</h3>
                        <p className="text-sm text-gray-600 mb-4">
                            Kliknij poni≈ºej aby zobaczyƒá pe≈Çny raport z wszystkimi szczeg√≥≈Çami technicznymi
                        </p>
                        <a
                            href={mobile.psi_report_url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-block px-6 py-3 rounded-lg text-white font-semibold transition"
                            style={{background: '#1e40af'}}
                            onMouseEnter={(e) => e.target.style.background = '#1e3a8a'}
                            onMouseLeave={(e) => e.target.style.background = '#1e40af'}
                        >
                            Otw√≥rz pe≈Çny raport PageSpeed Insights ‚Üó
                        </a>
                    </div>
                </div>
            );
        }

        function StrategyTab({ results }) {
            const siteWide = results.site_wide_analysis || {};
            const actionPlan = results.homepage?.ai_action_plan || results.ai_action_plan || {};
            const recommendations = siteWide.scalable_recommendations || [];
            const roadmap = actionPlan.action_plan?.roadmap || siteWide.roadmap || {};

            return (
                <div className="space-y-6">
                    {/* Site Strategy */}
                    {siteWide.site_strategy && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-xl font-bold mb-4">üéØ Strategia witryny</h3>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <p className="text-sm text-gray-600">G≈Ç√≥wny cel biznesowy</p>
                                    <p className="font-semibold mt-1">{siteWide.site_strategy.primary_business_goal}</p>
                                </div>
                                <div>
                                    <p className="text-sm text-gray-600">Jasno≈õƒá grupy docelowej</p>
                                    <p className={`text-2xl font-bold mt-1 ${getScoreColor(siteWide.site_strategy.target_audience_clarity)}`}>
                                        {siteWide.site_strategy.target_audience_clarity}/100
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Scalable Recommendations */}
                    {recommendations.length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-xl font-bold mb-4">üöÄ Skalowalne rekomendacje</h3>
                            <div className="space-y-4">
                                {recommendations.map((rec, idx) => (
                                    <div key={idx} className="border-l-4 border-purple-500 bg-purple-50 rounded-r p-4">
                                        <div className="flex items-start justify-between mb-3">
                                            <h4 className="font-bold flex-1">{rec.recommendation}</h4>
                                            <span className="px-3 py-1 rounded text-xs font-semibold ml-2" style={{
                                                background: rec.priority === 'CRITICAL' ? '#991b1b' :
                                                           rec.priority === 'HIGH' ? '#c2410c' :
                                                           rec.priority === 'MEDIUM' ? '#d97706' : '#166534',
                                                color: rec.priority === 'CRITICAL' ? '#fca5a5' :
                                                       rec.priority === 'HIGH' ? '#fed7aa' :
                                                       rec.priority === 'MEDIUM' ? '#fef3c7' : '#bbf7d0'
                                            }}>
                                                {rec.priority}
                                            </span>
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-3 text-sm mb-3">
                                            <div>
                                                <span className="text-gray-600">Kategoria:</span> <strong>{rec.category}</strong>
                                            </div>
                                            <div>
                                                <span className="text-gray-600">Zakres:</span> <strong>{rec.scope}</strong>
                                            </div>
                                            <div>
                                                <span className="text-gray-600">Czas:</span> <strong>{rec.time_estimate}</strong>
                                            </div>
                                            <div>
                                                <span className="text-gray-600">Odpowiedzialny:</span> <strong>{rec.owner}</strong>
                                            </div>
                                        </div>

                                        <div className="bg-white border border-purple-200 rounded p-3">
                                            <p className="text-sm"><strong>üíº Wp≈Çyw biznesowy:</strong> {rec.business_impact}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Roadmap */}
                    {(roadmap['30_days'] || roadmap.week_1) && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-xl font-bold mb-4">üìÖ Mapa drogowa</h3>
                            <div className="space-y-6">
                                {(roadmap['30_days'] || roadmap.week_1) && (
                                    <div className="timeline-item">
                                        <div className="timeline-dot bg-red-500"></div>
                                        <h4 className="font-bold text-red-900 mb-2">MiesiƒÖc 1 (Pilne)</h4>
                                        {(roadmap['30_days'] || roadmap.week_1).map((item, idx) => (
                                            <div key={idx} className="mb-3 p-3 bg-red-50 rounded">
                                                <p className="font-semibold">{typeof item === 'string' ? item : item.action}</p>
                                                {item.description && <p className="text-sm text-gray-600 mt-1">{item.description}</p>}
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {(roadmap['60_days'] || roadmap.month_1) && (
                                    <div className="timeline-item">
                                        <div className="timeline-dot bg-orange-500"></div>
                                        <h4 className="font-bold text-orange-900 mb-2">MiesiƒÖc 2-3</h4>
                                        {(roadmap['60_days'] || roadmap.month_1).map((item, idx) => (
                                            <div key={idx} className="mb-3 p-3 bg-orange-50 rounded">
                                                <p className="font-semibold">{typeof item === 'string' ? item : item.action}</p>
                                                {item.description && <p className="text-sm text-gray-600 mt-1">{item.description}</p>}
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {(roadmap['90_days'] || roadmap.month_3) && (
                                    <div className="timeline-item">
                                        <div className="timeline-dot bg-blue-500"></div>
                                        <h4 className="font-bold text-blue-900 mb-2">MiesiƒÖc 3+</h4>
                                        {(roadmap['90_days'] || roadmap.month_3).map((item, idx) => (
                                            <div key={idx} className="mb-3 p-3 bg-blue-50 rounded">
                                                <p className="font-semibold">{typeof item === 'string' ? item : item.action}</p>
                                                {item.description && <p className="text-sm text-gray-600 mt-1">{item.description}</p>}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // SINGLE-PAGE TAB COMPONENTS

        function OverviewTabSingle({ results, exportCSV, exportJSON, exportHTML }) {
            return (
                <div className="space-y-6">
                    {/* Score Card */}
                    <div className="bg-white rounded-lg shadow-md p-6 text-center">
                        <h2 className="text-2xl font-bold mb-4">Wynik audytu SEO</h2>
                        <div className={`text-6xl font-bold ${getScoreColor(results.final_score)} mb-2`}>
                            {results.final_score}/100
                        </div>
                        <div className="text-lg text-gray-600">{results.grade?.label}</div>
                        <a href={results.url} target="_blank" rel="noopener" className="text-sm text-blue-600 hover:underline break-all block mt-4">
                            {results.url} ‚Üó
                        </a>
                    </div>

                    {/* Category Scores */}
                    <div className="grid md:grid-cols-3 gap-4">
                        {Object.entries(results.categories || {}).map(([catName, catData]) => (
                            <div key={catName} className="bg-white rounded-lg shadow-md p-4 text-center">
                                <div className="text-sm text-gray-600 mb-2 capitalize">{catName}</div>
                                <div className={`text-4xl font-bold ${getScoreColor(catData.score)}`}>
                                    {Math.round(catData.score)}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Export */}
                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-lg font-bold mb-4">üì• Eksport wynik√≥w</h3>
                        <div className="flex flex-wrap gap-3">
                            <button onClick={exportHTML} className="px-6 py-3 text-white rounded-lg transition" style={{background: '#f97316'}}
                                onMouseEnter={(e) => e.target.style.background = '#ea580c'}
                                onMouseLeave={(e) => e.target.style.background = '#f97316'}>
                                üåê HTML (Interaktywny)
                            </button>
                            <button onClick={exportJSON} className="px-6 py-3 text-white rounded-lg transition" style={{background: '#1e40af'}}
                                onMouseEnter={(e) => e.target.style.background = '#1e3a8a'}
                                onMouseLeave={(e) => e.target.style.background = '#1e40af'}>
                                üìÑ JSON
                            </button>
                            <button onClick={exportCSV} className="px-6 py-3 text-white rounded-lg transition" style={{background: '#166534'}}
                                onMouseEnter={(e) => e.target.style.background = '#14532d'}
                                onMouseLeave={(e) => e.target.style.background = '#166534'}>
                                üìä CSV
                            </button>
                        </div>
                        <p className="text-sm text-gray-500 mt-3">
                            üí° <strong>HTML:</strong> Pe≈Çny raport - dzia≈Ça offline, mo≈ºna wys≈Çaƒá klientowi
                        </p>
                    </div>
                </div>
            );
        }

        function CategoriesTab({ results, showUrl = true }) {
            const [expandedCategory, setExpandedCategory] = useState(null);

            return (
                <div className="space-y-4">
                    {showUrl && (
                        <div className="bg-white rounded-lg shadow-md p-4 mb-4">
                            <p className="text-sm text-gray-600">Analizowana strona:</p>
                            <a href={results.url} target="_blank" rel="noopener" className="text-blue-600 hover:underline break-all">
                                {results.url} ‚Üó
                            </a>
                        </div>
                    )}

                    {Object.entries(results.categories || {}).map(([catName, catData]) => (
                        <div key={catName} className="bg-white rounded-lg shadow-md overflow-hidden">
                            <div
                                className="collapsible-header p-4 flex justify-between items-center"
                                onClick={() => setExpandedCategory(expandedCategory === catName ? null : catName)}
                            >
                                <div className="flex items-center gap-3 flex-1">
                                    <h3 className="font-bold capitalize">{catName}</h3>
                                    <span className={`text-2xl font-bold ${getScoreColor(catData.score)}`}>
                                        {Math.round(catData.score)}
                                    </span>
                                </div>
                                <span className="text-gray-400">{expandedCategory === catName ? '‚ñº' : '‚ñ∂'}</span>
                            </div>

                            {expandedCategory === catName && (
                                <div className="p-4 border-t bg-gray-50">
                                    {/* Checks */}
                                    {catData.checks && Object.keys(catData.checks).length > 0 && (
                                        <div className="mb-4">
                                            <h4 className="font-semibold mb-2">Szczeg√≥≈Çy:</h4>
                                            <div className="space-y-2">
                                                {Object.entries(catData.checks).map(([checkKey, checkData]) => (
                                                    <div key={checkKey} className="flex items-center justify-between p-2 bg-white rounded">
                                                        <span className="capitalize text-sm">{checkKey.replace(/_/g, ' ')}</span>
                                                        <span className="font-medium">{checkData.value}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Issues */}
                                    {catData.issues && catData.issues.length > 0 && (
                                        <div>
                                            <h4 className="font-semibold mb-2">Problemy:</h4>
                                            <div className="space-y-2">
                                                {catData.issues.map((issue, idx) => (
                                                    <div key={idx} className="p-3 bg-white border-l-4 border-orange-500 rounded-r">
                                                        <div className="flex items-start justify-between gap-2 mb-2">
                                                            <h5 className="font-bold flex-1">{issue.title}</h5>
                                                            <span className={getBadgeClass(issue.severity)}>{issue.severity}</span>
                                                        </div>
                                                        <p className="text-sm text-gray-600">{issue.description}</p>
                                                        {showUrl && (
                                                            <p className="text-xs text-gray-500 mt-2">
                                                                üîó {results.url}
                                                            </p>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );
        }

        function IssuesTabSingle({ results }) {
            return (
                <div className="bg-white rounded-lg shadow-md p-6">
                    <h3 className="text-xl font-bold mb-4">‚ö†Ô∏è Wszystkie problemy ({results.all_issues?.length || 0})</h3>

                    <div className="mb-4 p-3 bg-blue-50 rounded">
                        <p className="text-sm"><strong>üîó Analizowana strona:</strong></p>
                        <a href={results.url} target="_blank" rel="noopener" className="text-sm text-blue-600 hover:underline break-all">
                            {results.url} ‚Üó
                        </a>
                    </div>

                    <div className="space-y-3">
                        {results.all_issues && results.all_issues.map((issue, idx) => (
                            <div key={idx} className="p-4 border-l-4 border-orange-500 bg-orange-50 rounded-r">
                                <div className="flex items-start justify-between gap-2 mb-2">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className={getBadgeClass(issue.severity)}>{issue.severity}</span>
                                            <span className="text-xs text-gray-500">Impact: {issue.impact}/10</span>
                                        </div>
                                        <h4 className="font-bold">{issue.title}</h4>
                                    </div>
                                </div>
                                <p className="text-sm text-gray-700 mb-2">{issue.description}</p>
                                {issue.fix && (
                                    <div className="mt-2 p-2 bg-white rounded border">
                                        <p className="text-xs text-gray-600"><strong>üîß Fix:</strong> {issue.fix}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function QuickWinsTab({ results }) {
            return (
                <div className="bg-white rounded-lg shadow-md p-6">
                    <h3 className="text-xl font-bold mb-4">‚ö° Quick Wins ({results.quick_wins?.length || 0})</h3>
                    <p className="text-gray-600 mb-6">Szybkie wygrane - wysokie ROI, niski wysi≈Çek</p>

                    <div className="space-y-4">
                        {results.quick_wins && results.quick_wins.map((win, idx) => (
                            <div key={idx} className="border-l-4 border-green-500 bg-green-50 rounded-r p-4">
                                <div className="flex items-start justify-between mb-2">
                                    <h4 className="font-bold flex-1">{win.title}</h4>
                                    <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Impact: {win.impact}/10</span>
                                </div>
                                <p className="text-sm text-gray-700 mb-2">{win.description}</p>
                                <div className="mt-3 p-2 bg-white rounded border border-green-200">
                                    <p className="text-xs"><strong>üîó Dotyczy:</strong> {results.url}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Render
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
